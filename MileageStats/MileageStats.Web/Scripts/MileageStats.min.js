(function(a){var c="postalcode",b="textlineinput";a.validator.addMethod(b,function(b,d,c){if(!b)return true;try{var a=b.match(c);return a&&a.index===0&&a[0].length===b.length}catch(e){return false}});a.validator.unobtrusive.adapters.add(b,["pattern"],function(a){a.rules.textlineinput=a.params.pattern;if(a.message)a.messages.textlineinput=a.message});a.validator.unobtrusive.adapters.addSingleVal(b,"pattern");a.validator.addMethod(c,function(i,j,c){if(!i)return true;try{var g=a("#Country").val(),d=a("#PostalCode").val(),h=d.match(c.unitedStatesPattern),f=d.match(c.internationalPattern),e="",b;if(g.toLowerCase()==="united states"){e=c.unitedStatesErrorMessage;b=h}else{e=c.internationalErrorMessage;b=f}a.extend(a.validator.messages,{postalcode:e});return b&&b.index===0&&b[0].length===d.length}catch(k){return false}});a.validator.unobtrusive.adapters.add(c,["internationalErrorMessage","unitedStatesErrorMessage","internationalPattern","unitedStatesPattern"],function(a){a.rules.postalcode=a.params})})(jQuery);(function(a){a.log=function(b){var a="undefined";typeof console!==a&&typeof console.log!==a&&console.log(b)};a.strings={shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]};a.makeDate=function(g){var c=g.replace(/^\/Date\(/,"").replace(/\)\//,""),b=new Date(Number(c)),f=b.getDate().toString(),d=a.strings.shortMonths[b.getMonth()],e=b.getFullYear().toString();return f+" "+d+" "+e};a.makeMoney=function(a){a=(Math.round(a*100)/100).toString();if(a.indexOf(".")>=0){if(a.substring(a.indexOf(".")+1).length===1)a+="0"}else a+=".00";return a};a.makeMPGDisplay=function(a){return Math.round(a).toString()};a.makeCostToDriveDisplay=function(c){var b=a.makeMoney(c*100);return Math.round(b).toString()};a.makeCostPerMonthDisplay=function(c){var b=a.makeMoney(c);return Math.round(b).toString()};a.getRelativeEndpointUrl=function(d){var c,e=function(a){return a===null||a===undefined?"":a.split("/")},f=function(b,a){for(c=0;c<a.length;c+=1)if(a[c].length>0)b+="/"+a[c];return b},g=e(a.rootUrl),h=e(d),b="";if(!d)return"";if(d.indexOf(a.rootUrl||"")===0)return d;b=f(b,g);b=f(b,h);return b}})(this.mstats=this.mstats||{},jQuery);(function(a){a.events={status:"status",vehicle:{details:{selected:"details/selected"},fillups:{selected:"fillups/selected"},reminders:{selected:"reminders/selected",fulfilled:"reminders/fulfilled"},add:{selected:"add/selected"},deleted:"delete/succeeded"},dashboard:{selected:"dashboard/selected"},charts:{selected:"charts/selected"}}})(this.mstats=this.mstats||{},jQuery);(function(a){a.pubsub=function(){var a=[],b={};b.publish=function(b,f){var e,d,c=0;if(a[b])d=setInterval(function(){if(a[b][c]){e=a[b][c].context||this;a[b][c].callback.call(e,f);c+=1}else clearInterval(d)},0)};b.subscribe=function(b,c,d){if(!a[b])a[b]=[];a[b].push({callback:c,context:d})};b.unsubscribe=function(b,c,d){a[b]&&a[b].pop({callback:c,context:d})};return b}()})(this.mstats=this.mstats||{},jQuery);(function(a,b){a.dataStore={_data:{},"get":function(a){return this._data[a]},"set":function(b,a){this._data[b]=a},clear:function(a){this._data[a]=undefined},clearAll:function(){this._data={}}};a.dataManager={dataDefaults:{dataType:"json",type:"POST"},sendRequest:function(d){var g=a.dataManager,e=a.getRelativeEndpointUrl(d.url),f=a.dataStore.get(e),c=b.extend({cache:true},g.dataDefaults,d,{url:e});if(c.cache&&f){d.success(f);return}c.success=function(b){c.cache&&a.dataStore.set(e,b);d.success(b)};b.ajax(c)},resetData:function(b){a.dataStore.clear(a.getRelativeEndpointUrl(b))}}})(this.mstats=this.mstats||{},jQuery);(function(a,b){b.widget("mstats.status",{options:{duration:3e3,subscribe:function(){a.log("The subscribe option on status has not been set")}},_create:function(){this.options.subscribe(a.events.status,this._statusSubscription,this)},currentStatus:null,priorities:{saveError:1,saved:2,saving:3,loadError:4},_statusSubscription:function(b){var a=this;b.priority=a._getPriority(b);a.currentStatus&&b.priority<a.currentStatus.priority&&clearTimeout(a.currentStatus.timer);a.currentStatus=b;a.element.text(b.message).show();a.currentStatus.timer=setTimeout(function(){a.element.fadeOut();a.currentStatus=null},b.duration||a.options.duration)},_getPriority:function(a){return this.priorities[a.type]},destroy:function(){this.currentStatus&&clearTimeout(this.currentStatus.timer);b.Widget.prototype.destroy.call(this)}})})(this.mstats=this.mstats||{},jQuery);(function(b,a){a.widget("mstats.header",{_create:function(){b.header=this;this._addClasses();this._adjustNavigation()},_addClasses:function(){this.element.find("div > div > h1").addClass("data-header-text")},_adjustNavigation:function(){var c=a.bbq.getState()||{},d=b.getRelativeEndpointUrl("/Dashboard");c.layout="dashboard";this.element.find("#dashboard-link").attr("href",a.param.fragment(d,c));c.layout="charts";this.element.find("#charts-link").attr("href",a.param.fragment(d,c))},_setOption:function(c,b){switch(c){case"title":this.element.find(".data-header-text").text(b)}a.Widget.prototype._setOption.apply(this,arguments)}})})(this.mstats=this.mstats||{},jQuery);(function(a){a.widget("mstats.tile",{_create:function(){this.element.addClass("mstats-tile")},moveTo:function(b,e){var c=this,d=0;c._unlock();if(b.length){d=b.length;a.each(b,function(b,a){if(b===d-1)c._animate(a,e);else c._animate(a)})}else c._animate(b,e)},_animate:function(a,b){this.element.animate(a.position,{duration:a.duration,queue:a.queueName,complete:function(){b&&b()}})},_unlock:function(){this.element.css({position:"absolute","float":"none"})},beginAnimation:function(){var a=this.element;a.css({top:a.position().top+"px",left:a.position().left+"px"})},endAnimation:function(){this.element.attr("style","").css({top:0,left:0,position:"relative","float":"left"})}})})(jQuery);(function(m,j){var k="collapsed",d="compact",i=".mstats-vehicle",h=".statistics",g=".cost-per-month",f=".cost-per-mile",b=".unit",a=".quantity",e=".mile-per-gallon",c=600,l=800;j.widget("mstats.vehicle",{options:{id:0,collapsed:false},_create:function(){var a=this;a._setOption("id",a.element.data("vehicle-id"));a._addClasses();a._adjustNavigation();a.options.collapsed&&a._forceCollapse()},_forceCollapse:function(){this.element.find(e).find(a).hide().end().find(b).hide().end().end().find(f).find(a).hide().end().find(b).hide().end().end().find(g).find(a).hide().end().find(b).hide().end().end().find(h).height(0).closest(i).addClass(d)},_addClasses:function(){this.element.addClass("mstats-vehicle").find(".avatar img").addClass("mstats-photo")},_adjustNavigation:function(){var a=this;this.element.find("[data-action]").each(function(){var c=j(this),f=c.data("action"),e=a.options.id,b=j.bbq.getState()||{},d=m.getRelativeEndpointUrl("/Dashboard");b.vid=e;switch(f){case"vehicle-details-selected":b.layout="details";break;case"vehicle-fillups-selected":b.layout="fillups";break;case"vehicle-reminders-selected":b.layout="reminders";break;case"vehicle-add-selected":b.layout="addVehicle";b.vid=undefined}c.attr("href",j.param.fragment(d,b))})},collapse:function(){if(this.options.collapsed)return;this.element.find(e).find(a).fadeOut(c).end().find(b).fadeOut(c).end().end().find(f).find(a).fadeOut(c).end().find(b).fadeOut(c).end().end().find(g).find(a).fadeOut(c).end().find(b).fadeOut(c).end().end().find(h).animate({height:0},{duration:l,easing:"linear",complete:function(){j(this).closest(i).addClass(d)}});this._setOption(k,true)},expand:function(){if(!this.options.collapsed)return;this.element.removeClass(d).find(h).animate({height:115},{duration:l,easing:"linear"}).find(e).find(a).fadeIn(c).end().find(b).fadeIn(c).end().end().find(f).find(a).fadeIn(c).end().find(b).fadeIn(c).end().end().find(g).find(a).fadeIn(c).end().find(b).fadeIn(c).end().end();this._setOption(k,false)}})})(this.mstats=this.mstats||{},jQuery);(function(q,a){var f="endAnimation",p="beginAnimation",s="moveRight",r="moveLeft",e="id",c="option",h="compact",j=".mstats-vehicle",b=".mstats-tile",v="#vehicle-list-content > div",o="vehicle-id",d=".vehicle",n="selectedVehicleId",u="mstats-vehicle-list-content",m="#vehicle-list-content",t="mstats-vehicle-list",g=false,l=true,k="dashboard",i=600,w=400,x;a.widget("mstats.vehicleList",{options:{sendRequest:function(b){a.ajax(b)},invalidateData:function(){q.log("no data invalidation function provided.")},layout:k,publish:q.pubsub.publish,selectedVehicleId:0,isOnScreen:l,isCollapsed:g},_create:function(){var a=this;q.vehicleList=a;x=a.element.data("list-url");a._addClasses();a._widgetizeVehicleTiles();a._bindEventHandlers();a._makeSortable();a._getVehicleData();a._setOptions(a.options);if(a.options.layout!==k){a._setOption("isCollapsed",l);a._checkSelectedVehicleId()}},_addClasses:function(){this.element.addClass(t).find(m).addClass(u)},_bindEventHandlers:function(){var b=this;this.element.delegate("[data-action]","click.vehicleList",function(){b._setOption(n,a(this).closest(d).data(o))})},_widgetizeVehicleTiles:function(){this.element.find(v).tile().find(d).vehicle()},_getVehicleData:function(){var b=this,c=a(this.options.templateId);if(!c.length){b._showVehicles();q.log("Cannot apply templates as there is no template defined.");return}b.options.sendRequest({url:x,success:function(d){a(m,b.element).html(c.tmpl(d)).append(a("#mstats-add-vehicle-button-template").tmpl());b._addClasses();b._widgetizeVehicleTiles();b._setOptions(b.options);b._showVehicles()},error:function(){b._hideVehicles();b._showErrorMessage()}})},_hideVehicles:function(){this.element.find(b).hide()},_showVehicles:function(){this.element.find(b).show()},_publishStatus:function(b){a.isFunction(this.options.publish)&&this.options.publish(q.events.status,b)},_showErrorMessage:function(){this._publishStatus({type:"loadError",message:"An error occurred while loading the requested data.  Please try again.",duration:1e4})},_showSaveMessage:function(){this._publishStatus({type:"saving",message:"Saving sort order ..."})},_showSavedMessage:function(){this._publishStatus({type:"saved",message:"Sort order saved",duration:5e3})},_showSaveErrorMessage:function(){this._publishStatus({type:"saveError",message:"An error occurred while saving the sort order.  Please reload the page and try again.",duration:1e4})},_makeSortable:function(){var a=this;this.element.sortable({axis:g,items:".mstats-tile:has(.mstats-vehicle)",containment:"#vehicles",handle:".header",stop:function(){a.saveSortOrder()}})},saveSortOrder:function(){var b=this,c=[];this.element.find(j).each(function(){var b=a(this).data(o);c.push(b)});b._showSaveMessage();a.ajax({type:"POST",dataType:"json",url:q.getRelativeEndpointUrl("/Vehicle/UpdateSortOrder"),data:{SortOrder:c.toString()},success:function(){b._showSavedMessage()},error:function(){b._showSaveErrorMessage()}})},_setOption:function(d,c){var b=this;a.Widget.prototype._setOption.apply(b,arguments);if(c<=0)return;switch(d){case"layout":b._setLayoutOption(c);break;case n:b._expandVehicle(c);b._collapseVehicles()}},_checkSelectedVehicleId:function(){var c,b=a.bbq.getState()||{};if(b.vid){c=parseInt(b.vid,10);c!==this.options.selectedVehicleId&&this._setOption(n,b.vid)}},_setLayoutOption:function(a){switch(a.toLowerCase()){case k:this.element.removeAttr("style").removeClass(h).sortable(c,"axis",g);break;case"details":case"reminder":case"fillup":this.element.removeAttr("style").addClass(h).sortable(c,"axis","y");this._collapseVehicles()}},_collapseVehicles:function(){var b=this.options.selectedVehicleId;this.element.find(j).each(function(){var d=a(this);d.vehicle(c,e)!==b&&d.vehicle("collapse")})},_expandVehicles:function(){this.element.find(j).each(function(){a(this).vehicle("expand")})},_expandVehicle:function(d){var b=d;a(j,this.element).each(function(){var d=a(this);d.vehicle(c,e)===b&&d.vehicle(c,"collapsed")&&d.vehicle("expand")})},_narrowToSingleColumn:function(){var a=this.element;!this.options.isCollapsed&&a.delay(w).animate({left:0},{duration:i,queue:r,complete:function(){a.addClass(h)}})},_expandToDoubleColumn:function(){this.options.isCollapsed&&this.element.removeClass(h).animate({left:400},{duration:i,queue:s})},_scrollToSelectedVehicle:function(){var f=this;a(b,f.element).each(function(){var h,b,g=a(this);h=g.find(d).vehicle(c,e);b=g.offset().top;if(h===f.options.selectedVehicleId)b>300&&a("html, body").delay(w).animate({scrollTop:b},500)})},goToDetailsLayout:function(){var h=this,n,o=0,j=0,m,g=h,k=a.bbq.getState()||{};g._checkSelectedVehicleId();n=h.options.selectedVehicleId;if(!g.options.isCollapsed){h.element.find(b).each(function(){a(this).tile(p)});h.element.find(b).each(function(){var h=a(this);o=h.find(d).vehicle(c,e);m=[{position:{top:j},duration:i,queueName:"moveDown"},{position:{left:0},duration:i,queueName:r}];h.tile("moveTo",m,function(){g.element.find(b).each(function(){a(this).tile(f)})});if(o===n)j+=321;else j+=206});g._narrowToSingleColumn()}g._scrollToSelectedVehicle();if(k&&k.layout)g.options.layout=k.layout;g.options.isCollapsed=l},goToDashboardLayout:function(){var l=0,h=this,j;h.options.layout=k;h.options.selectedVehicleId=0;if(!h.options.isCollapsed)return;h.element.find(b).each(function(){a(this).tile(p)});h._expandToDoubleColumn();h.element.find(b).each(function(k){var g=a(this);l=g.find(d).vehicle(c,e);j=[{position:{left:k%2*260},duration:i,queueName:s},{position:{top:Math.floor(k/2)*320},duration:i,queueName:"moveUp"}];h._expandVehicles();g.tile("moveTo",j,function(){h.element.find(b).each(function(){a(this).tile(f)})})});h.options.isCollapsed=g},moveOffScreen:function(){var a=this;if(!a.options.isOnScreen)return;a.element.css("position","absolute").delay(w).animate({left:"-=600",opacity:0},{duration:i,complete:function(){a.element.hide()}});a.options.isOnScreen=g},moveOnScreen:function(){if(this.options.isOnScreen)return;this.element.css("opacity",0).animate({opacity:1,left:"+=600"},i).show();this._setOption("isOnScreen",l)},_invalidateData:function(){a.isFunction(this.options.invalidateData)&&this.options.invalidateData(x)},refreshData:function(){this._getVehicleData()},requeryData:function(){this._invalidateData();this.refreshData()},destroy:function(){var b="destroy";this.element.sortable(b).undelegate(".vehicleList").removeClass(t).find(v).tile(b).find(d).vehicle(b).find(m).removeClass(u);a.Widget.prototype.destroy.call(this)}})})(this.mstats=this.mstats||{},jQuery);(function(b,a){var d=".mstats-vehicle-details-content",c="mstats-vehicle-details";a.widget("mstats.vehicleDetails",{options:{sendRequest:function(b){a.ajax(b)},publish:function(){b.log("The publish option on vehicleDetails has not been set")},invalidateData:function(){b.log("The invalidateData option on vehicleDetails has not been set")},templateId:""},data:{selectedVehicleName:undefined},_create:function(){var a=this;b.vehicleDetails=a;a._addClasses();a._bindNavigation();a._setOptions(a.options)},_addClasses:function(){this.element.addClass(c).find(".content").addClass("mstats-vehicle-details-content").find("#vehicle-charts").addClass("mstats-vehicle-charts")},_bindNavigation:function(){var b=this;this.element.delegate("[data-action]","click",function(e){var c=a(this),d=c.data("action");switch(d){case"vehicle-delete-selected":b.deleteVehicle(c.data("action-url"));e.preventDefault()}})},_getVehicleData:function(){var c=this;c.data.selectedVehicleName=undefined;c._hideVehicleDetails();c.options.sendRequest({url:c.options.dataUrl+"/"+this.options.selectedVehicleId,success:function(e){var d;if(!a(c.options.templateId).length){c._showVehicleDetails();b.log("Vehicle Details: Cannot apply templates as there is no template defined.");return}c.element.html(a(c.options.templateId).tmpl(e,{createRemindersLink:function(e){var c=a.bbq.getState()||{},d=b.getRelativeEndpointUrl("/Dashboard");c.layout="reminders";c.vid=e;return a.param.fragment(d,c)}}));c._addClasses();c._attachCharts();c.data.selectedVehicleName=e.Name;d=b.header.option("title")||"";d.indexOf(" for ")===-1&&b.header.option("title",d+" for "+e.Name);c._showVehicleDetails()},error:function(){c._hideVehicleDetails();c._showErrorMessage()}})},_attachCharts:function(){a(".mstats-vehicle-charts",this.element).vehicleCharts({sendRequest:this.options.sendRequest,invalidateData:this.options.invalidateData})},_deleteVehicle:function(d){var c=this;c.options.sendRequest({url:d,dataType:"json",type:"POST",cache:false,success:function(){c._showDeletedMessage();c.options.publish&&a.isFunction(c.options.publish)&&c.options.publish(b.events.vehicle.deleted,{})},error:function(){c._showDeleteErrorMessage()}})},_showVehicleDetails:function(){a(d,this.element).show()},_hideVehicleDetails:function(){a(d,this.element).hide()},_publishStatus:function(c){a.isFunction(this.options.publish)&&this.options.publish(b.events.status,c)},_showErrorMessage:function(){this._publishStatus({type:"loadError",message:"An error occurred while loading the requested data.  Please try again.",duration:1e4})},_showDeletingMessage:function(){this._publishStatus({type:"saving",message:"Deleting the selected vehicle ...",duration:5e3})},_showDeletedMessage:function(){this._publishStatus({type:"saved",message:"Vehicle deleted.",duration:5e3})},_showDeleteErrorMessage:function(){this._publishStatus({type:"saveError",message:"An error occurred while deleting the selected vehicle.  Please try again.",duration:1e4})},_setOption:function(c,b){a.Widget.prototype._setOption.apply(this,arguments);if(b<=0)return;switch(c){case"selectedVehicleId":this.refreshData()}},refreshData:function(){this._getVehicleData()},requeryData:function(){this.options.invalidateData(this.options.dataUrl);this.refreshData()},getSelectedVehicleName:function(){return this.data.selectedVehicleName},deleteVehicle:function(b){var a=confirm("Really delete the selected vehicle?");a&&this._deleteVehicle(b)},destroy:function(){a.Widget.prototype.destroy.apply(this,arguments);this.element.removeClass(c)}})})(this.mstats=this.mstats||{},jQuery);(function(c,a){var e=".mstats-fillups-content",b="selectedFillupId",d="mstats-fillups";a.widget("mstats.fillups",{options:{sendRequest:function(b){a.ajax(b)},publish:function(){c.log("The publish option on fillups has not been set")},invalidateData:function(){c.log("no data invalidation function provided.")},selectedVehicleId:0,selectedFillupId:0,templateId:""},_create:function(){var a=this;c.fillups=a;a._addClasses();a._bindNavigation();a._setOptions(a.options)},_addClasses:function(){this.element.addClass(d).find(".content").addClass("mstats-fillups-content")},_bindNavigation:function(){var c=this;this.element.delegate("[data-action]","click.fillups",function(d){if(a(this).data("action")==="select-fillup"){c._setOption(b,a(this).data("fillup-id"));d.preventDefault()}})},_getFillupData:function(){var b=this;b._hideFillups();b.options.sendRequest({type:"POST",url:b.options.dataUrl+"/"+this.options.selectedVehicleId,success:function(d){if(!a(b.options.templateId).length){b._showFillups();c.log("Fillups: Cannot apply templates as there is no template defined.");return}b.options.data=d;b._updateSelectedFillup();b._applyTemplate();b._addClasses();b._showFillups()},error:function(){b._hideFillups();b._showErrorMessage()}})},_applyTemplate:function(){var b=this.options,c=a(b.templateId);c.length&&b.data&&this.element.html(c.tmpl(b.data))},_showFillups:function(){this.element.find(e).show()},_hideFillups:function(){this.element.find(e).hide()},_updateSelectedFillup:function(){var b,c,a=this.options.data,d=this.options.selectedFillupId;if(a.Fillups&&a.Fillups.length)if(d>0){a.SelectedFillup=a.Fillups[0];for(b=0;b<a.Fillups.length;b+=1){c=a.Fillups[b];if(c.FillupEntryId===d){a.SelectedFillup=c;break}}}else a.SelectedFillup=a.Fillups[0]},_publishStatus:function(b){a.isFunction(this.options.publish)&&this.options.publish(c.events.status,b)},_showErrorMessage:function(){this._publishStatus({type:"loadError",message:"An error occurred while loading the requested data.  Please try again.",duration:1e4})},_setOption:function(e,d){var c=this;a.Widget.prototype._setOption.apply(c,arguments);if(d<=0)return;switch(e){case"selectedVehicleId":c.refreshData();break;case b:c._updateSelectedFillup();c._applyTemplate()}},refreshData:function(){this._getFillupData()},requeryData:function(){this.options.invalidateData(this.options.dataUrl);this.refreshData()},destroy:function(){this.element.undelegate(".fillups").removeClass(d);a.Widget.prototype.destroy.call(this)}})})(this.mstats=this.mstats||{},jQuery);(function(c,b){var e=".mstats-reminders-pane-content",a="selectedReminderId",d="mstats-reminders-pane";b.widget("mstats.reminders",{options:{sendRequest:function(a){b.ajax(a)},publish:function(){c.log("The publish option for reminders has not been set")},invalidateData:function(){c.log("The invalidateData option for reminders has not been set")},selectedVehicleId:0,selectedReminderId:0,templateId:"",data:{}},_create:function(){var a=this;c.reminders=a;a._addClasses();a._bindNavigation();a._setOptions(a.options)},_addClasses:function(){this.element.addClass(d).find(".content").addClass("mstats-reminders-pane-content")},_bindNavigation:function(){var c=this;this.element.delegate("[data-action]","click.reminders",function(e){var d=b(this),g=d.data("action"),f=d.data("reminder-id");switch(g){case"select-reminder":c._setOption(a,f);e.preventDefault();break;case"reminder-fulfill-selected":c.fulfillReminder(d.data("action-url"));e.preventDefault()}})},_fulfillReminder:function(d){var a=this;a._showFulfillingMessage();a.options.sendRequest({url:d,dataType:"json",type:"POST",cache:false,success:function(){a._showFulfilledMessage();b.isFunction(a.options.publish)&&a.options.publish(c.events.vehicle.reminders.fulfilled,{})},error:function(){a._showFulfillErrorMessage()}})},_getReminderData:function(){var a=this;a._hideReminders();a.options.sendRequest({url:a._createRequestUrl(),success:function(d){if(!b(a.options.templateId).length){a._showReminders();c.log("reminders: Cannot apply templates as there is no template defined.");return}a._setOption("data",d);a._updateSelectedReminder();a._applyTemplate();a._addClasses();a._showReminders()},error:function(){a._hideReminders();a._showErrorMessage()}})},_updateSelectedReminder:function(){var b=this.options.data,e=this.options.selectedReminderId,d,c;if(b.Reminders&&b.Reminders.length)if(e>0)for(c=0;c<b.Reminders.length;c+=1){d=b.Reminders[c];if(d.ReminderId===e){b.SelectedReminder=d;break}}else{b.SelectedReminder=b.Reminders[0];this._setOption(a,b.SelectedReminder.ReminderId)}},_applyTemplate:function(){var a=this.options,c=b(a.templateId);c.length&&a.data&&this.element.html(c.tmpl(a.data))},_showReminders:function(){this.element.find(e).show()},_hideReminders:function(){this.element.find(e).hide()},_publishStatus:function(a){b.isFunction(this.options.publish)&&this.options.publish(c.events.status,a)},_showErrorMessage:function(){this._publishStatus({type:"loadError",message:"An error occurred while loading the requested data.  Please try again.",duration:1e4})},_showFulfillingMessage:function(){this._publishStatus({type:"saving",message:"Fulfilling the selected reminder ...",duration:5e3})},_showFulfilledMessage:function(){this._publishStatus({type:"saved",message:"Reminder Fulfilled.",duration:5e3})},_showFulfillErrorMessage:function(){this._publishStatus({type:"saveError",message:"An error occurred while fulfilling the selected reminder.  Please try again.",duration:1e4})},_setOption:function(e,d){var c=this;b.Widget.prototype._setOption.apply(c,arguments);if(d<=0)return;switch(e){case"selectedVehicleId":c.refreshData();break;case a:c._updateSelectedReminder();c._applyTemplate()}},_createRequestUrl:function(){return this.options.dataUrl+"/"+this.options.selectedVehicleId},fulfillReminder:function(a){var b=confirm("Are you sure you want to fulfill this reminder?");b&&this._fulfillReminder(a)},refreshData:function(){this._setOption(a,-1);this._setOption("data",{});this._getReminderData()},requeryData:function(){this.options.invalidateData(this._createRequestUrl());this.refreshData()},destroy:function(){b.Widget.prototype.destroy.call(this);this.element.undelegate(".remdinders").removeClass(d)}})})(this.mstats=this.mstats||{},jQuery);(function(a,h){var k="requeryData",b=true,j="title",g="selectedVehicleId",e="reminders",d="fillups",i="div:first",l="absolute",c="details",f=false,m=600,n=550;h.widget("mstats.infoPane",{options:{isOnScreen:f,activePane:c,selectedVehicleId:0,sendRequest:function(){a.log("The sendRequest option on infoPane has not been set")},invalidateData:function(){a.log("The invalidateData option on infoPane has not been set")},publish:function(){a.log("The publish option on infoPane has not been set")}},_create:function(){var b=this;a.infoPane=b;b._addClasses();b._setupDetailsPane();b._setupRemindersPane();b._setupFillupsPane();b._bindNavigation();b.element.css("position",l)},_addClasses:function(){this.element.addClass("mstats-info-pane")},_setupDetailsPane:function(){var b="#details-pane",c=this,d=c.element;!d.find(b).length&&d.find(i).append('<div id="details-pane" class="tab opened section" />');a.infoPane.vehicleDetails=d.find(b).vehicleDetails({sendRequest:c.options.sendRequest,dataUrl:"/Vehicle/JsonDetails",templateId:"#mstats-vehicle-details-template",invalidateData:c.options.invalidateData,publish:c.options.publish})},_setupFillupsPane:function(){var b="#fillups-pane",c=this,d=c.element;!d.find(b).length&&d.find(i).append('<div id="fillups-pane" class="tab section" />');a.infoPane.fillups=d.find(b).fillups({sendRequest:c.options.sendRequest,dataUrl:"/Fillup/JsonList",templateId:"#mstats-fillups-template",invalidateData:c.options.invalidateData,publish:c.options.publish})},_setupRemindersPane:function(){var b="#reminders-pane",c=this,d=c.element;!d.find(b).length&&d.find(i).append('<div id="reminders-pane" class="tab section" />');a.infoPane.reminders=d.find(b).reminders({sendRequest:c.options.sendRequest,dataUrl:"/Reminder/JsonList",templateId:"#mstats-reminders-template",invalidateData:c.options.invalidateData,publish:c.options.publish})},_bindNavigation:function(){var a=this;this.element.delegate("[data-info-nav]","click.infoPane",function(f){var b=h(this).data("info-nav");switch(b){case c:a._setHashLayout(c);break;case d:a._setHashLayout(d);break;case e:a._setHashLayout(e)}f.preventDefault()})},_setOption:function(b,a){h.Widget.prototype._setOption.apply(this,arguments);switch(b){case g:a=parseInt(a,10);this._setSelectedVehicleId(a);break;case"activePane":this._setActivePane(a)}},_setSelectedVehicleId:function(h){var b="option",f=this;a.infoPane.vehicleDetails.vehicleDetails(b,g,h);a.infoPane.fillups.fillups(b,g,h);a.infoPane.reminders.reminders(b,g,h);switch(f.options.activePane){case c:f._detailsSelected();break;case d:f._fillupsSelected();break;case e:f._remindersSelected()}},_setActivePane:function(a){switch(a){case c:this._detailsSelected();break;case d:this._fillupsSelected();break;case e:this._remindersSelected()}},_setOpen:function(b){var a,c;for(a in b)if(b.hasOwnProperty(a)){c=b[a];if(c)h(a,this.element).addClass("opened",300);else h(a,this.element).removeClass("opened",300)}},_setHashLayout:function(b){var a=h.bbq.getState()||{};a.layout=b;h.bbq.pushState(a,2)},_detailsSelected:function(){a.header.option(j,"Details");this._setOpen({"#details-pane":b,"#fillups-pane":f,"#reminders-pane":f})},_fillupsSelected:function(){a.header.option(j,"Fill ups");this._setOpen({"#details-pane":b,"#fillups-pane":b,"#reminders-pane":f})},_remindersSelected:function(){a.header.option(j,"Reminders");this._setOpen({"#details-pane":b,"#fillups-pane":b,"#reminders-pane":b})},moveOnScreenFromRight:function(){this.element.removeClass("empty").css({left:900,opacity:0,position:"relative"}).delay(n).animate({left:"-=640",opacity:1},m);this._setOption("isOnScreen",b)},moveOffScreenToRight:function(){var a=this;a.element.css({position:l,top:0}).animate({left:"+=640",opacity:0},{duration:m});a.options.isOnScreen=f},requeryVehicleDetails:function(){a.infoPane.vehicleDetails.vehicleDetails(k)},requeryFillups:function(){a.infoPane.fillups.fillups(k)},requeryReminders:function(){a.infoPane.reminders.reminders(k)},destroy:function(){var b="destroy";this.element.undelegate(".infoPane");a.infoPane.vehicleDetails.vehicleDetails(b);a.infoPane.fillups.fillups(b);a.infoPane.reminders.reminders(b)}})})(this.mstats=this.mstats||{},jQuery);(function(e,b){var d="mstats-registration-content",c="mstats-registration",a="#registration-content";b.widget("mstats.registration",{options:{sendRequest:function(a){b.ajax(a)},publish:function(){e.log("The publish option on registration has not been set")}},_create:function(){var a=this;e.registration=a;a._applyTemplate();a._addClasses();a._bindNavigation()},_applyTemplate:function(){var c=b(this.options.templateId);if(!c.length){e.log("Cannot apply templates as there is no template defined.");return}this.element.find(a).html(c.tmpl({}))},_addClasses:function(){this.element.addClass(c).find(a).addClass(d)},_bindNavigation:function(){var a=this;this.element.delegate("form","submit.registration",function(b){a.saveProfile();b.preventDefault()})},saveProfile:function(){var a=this,c=a,d={UserId:a.element.find("#UserId").val(),AuthorizationId:a.element.find("#AuthorizationId").val(),DisplayName:a.element.find("#DisplayName").val(),Country:a.element.find("#Country").val(),PostalCode:a.element.find("#PostalCode").val()};c._showSavingMessage();c.options.sendRequest({url:c.options.dataUrl,data:d,dataType:"json",type:"POST",cache:false,success:function(){c._startHidingWidget();c._showSavedMessage();b("#welcome b").text(d.DisplayName)},error:function(){c._showSavingErrorMessage()}})},_publishStatus:function(a){b.isFunction(this.options.publish)&&this.options.publish(e.events.status,a)},_showSavingMessage:function(){this._publishStatus({type:"saving",message:"Saving registration information...",duration:5e3})},_showSavedMessage:function(){this._publishStatus({type:"saved",message:"Registration saved",duration:5e3})},_showSavingErrorMessage:function(){this._publishStatus({type:"saveError",message:"An error occurred while saving your registration.  Please try again.",duration:5e3})},_startHidingWidget:function(){this.element.find(".mstats-registration-content").slideUp("slow").end().delay(2e3).slideUp("slow")},destroy:function(){this.element.undelegate(".registration").removeClass(c).find(a).removeClass(d);b.Widget.prototype.destroy.call(this)}})})(this.mstats=this.mstats||{},jQuery);(function(b,a){if(a.jqplot&&a.jqplot.config)a.jqplot.config.enablePlugins=true;a.widget("mstats.vehicleCharts",{options:{sendRequest:function(b){a.ajax(b)},chartData:[]},_create:function(){b.vehicleCharts=this;this._fetchChartData()},_fetchChartData:function(){var a=this,b=this.element;b&&a.options.sendRequest({url:b.attr("data-chart-url"),type:"POST",success:function(b){a._updateChartData(b);a._plotCharts()}})},_updateChartData:function(a){if(!a||!a.Entries||!a.Entries.length)return;for(var j=-1,c=-1,d=0,g=[],h=[],i=[],f,e,b=0;b<a.Entries.length;b+=1){if(j!==a.Entries[b].Id){c+=1;d=0;g[c]={id:a.Entries[b].Id,name:a.Entries[b].Name,series:[]};h[c]={id:a.Entries[b].Id,name:a.Entries[b].Name,series:[]};i[c]={id:a.Entries[b].Id,name:a.Entries[b].Name,series:[]}}f=a.Entries[b].Month.toString();if(a.Entries[b].Month<10)f="0"+f;e=a.Entries[b].Year.toString()+"-"+f+"-01";g[c].series[d]=[e,a.Entries[b].AverageFuelEfficiency];h[c].series[d]=[e,a.Entries[b].TotalDistance];i[c].series[d]=[e,a.Entries[b].TotalCost];d+=1;j=a.Entries[b].Id}this._setOption("chartData",[g,h,i])},_plotCharts:function(){var b=this,a=b.options.chartData;a&&a.length>0&&b._plotChart("#vehicle-fuel-efficiency-chart",a[0]);a&&a.length>1&&b._plotChart("#vehicle-distance-chart",a[1]);a&&a.length>2&&b._plotChart("#vehicle-cost-chart",a[2])},_plotChart:function(e,d){var b=false,f,c;if(!d||!d.length)return;c=this._getJQPlotSeries(d);f=this.element.find(e);f.children().remove();if(!c||!c.values.length)return;a.jqplot(e.slice(1),c.values,{axes:{xaxis:{renderer:a.jqplot.DateAxisRenderer,tickInterval:"3 months",pad:1.5,rendererOptions:{tickRenderer:a.jqplot.CanvasAxisTickRenderer},tickOptions:{formatString:"%m-%y",fontSize:"8pt",fontFamily:"Tahoma",angle:0,fontWeight:"normal",fontStretch:1}}},axesDefaults:{useSeriesColor:true},cursor:{show:b,showVerticalLine:b,showHorizontalLine:b,showCursorLegend:b,showTooltip:b,zoom:b,intersectionThreshold:6},legend:{location:"s",show:b},seriesDefaults:{showMarker:true},series:[{lineWidth:2,markerOptions:{style:"filledCircle",size:6}}]})},_getJQPlotSeries:function(b){for(var c=[],d=0,a=0;a<b.length;a+=1)if(b[a].series.length!==0){c[d]=b[a].series;d+=1}return{values:c}}})})(this.mstats=this.mstats||{},jQuery);(function(p,b){var g="relative",n="absolute",m="#unavailable-message",l="#date-range-selection",f="#main-chart-plot",e="#loading-message",k="chart-url",j="#cost-link",i="#distance-link",h="#fuel-efficiency-link",d="#slider",a=true,c=false,o=800,q=450;b.widget("mstats.charts",{options:{sendRequest:function(a){b.ajax(a)},chartData:[],currentChart:0,isOnScreen:c,invalidateData:function(){p.log("The invalidateData option on charts has not been set")}},_create:function(){var c=this;p.charts=c;if(b.jqplot&&b.jqplot.config)b.jqplot.config.enablePlugins=a;c.wellKnownChartTitles=["Average Fuel Efficiency","Total Distance","Total Cost"];c.wellKnownSeriesColors=["#4bb2c5","#c5b47f","#EAA228","#579575","#839557","#958c12","#953579","#4b5de4","#d8b83f","#ff5800"];c.dateRange={min:0,lower:0,upper:0,max:0};c.datesInDateRange=[];c._bindNavigation();c._createDateRangeSlider();c._fetchChartData()},stubsApplied:c,_createDateRangeSlider:function(){var b=this;this.element.find(d).slider({range:a,min:0,max:0,values:[0,0],slide:function(c,a){b.dateRange.lower=a.values[0];b.dateRange.upper=a.values[1];b._updateRangeDatesText();b._refreshChart()}})},_resetDateRangeSlider:function(){var a=this;a.element.find(d).slider({min:a.dateRange.min,max:a.dateRange.max-1,values:[a.dateRange.min,a.dateRange.max-1]});a._updateRangeDatesText()},_updateRangeDatesText:function(){var a=this;a.datesInDateRange.length>a.dateRange.lower&&a.element.find("#lower").html(a.datesInDateRange[a.dateRange.lower]);a.datesInDateRange.length>a.dateRange.upper&&a.element.find("#upper").html(a.datesInDateRange[a.dateRange.upper])},showMainFuelEfficiencyChart:function(){this.currentChart=0;this._refreshChart()},showMainDistanceChart:function(){this.currentChart=1;this._refreshChart()},showMainCostChart:function(){this.currentChart=2;this._refreshChart()},_bindNavigation:function(){var a=this,b=a,c="click."+b.name;a.element.find(h).bind(c,function(a){b.showMainFuelEfficiencyChart();a.preventDefault()});a.element.find(i).bind(c,function(a){b.showMainDistanceChart();a.preventDefault()});a.element.find(j).bind(c,function(a){b.showMainCostChart();a.preventDefault()})},refreshData:function(){this._fetchChartData()},requeryData:function(){this.options.invalidateData(this.element.data(k));this.refreshData()},_fetchChartData:function(){var a=this,b=this.element;if(b){a.element.find(e).show();a.options.sendRequest({url:b.data(k),type:"POST",success:function(b){a._updateChartData(b);a._resetDateRangeSlider();a._refreshChart()}})}},_updateChartData:function(b){var g=this;if(!b||!b.Entries)return;for(var h,f,n=-1,d=-1,e=0,m=[],k=[],i=[],j=[],l=[],c=0;c<b.Entries.length;c+=1){if(n!==b.Entries[c].Id){d+=1;e=0;k[d]=[];m[d]={id:b.Entries[c].Id,name:b.Entries[c].Name};i[d]={id:b.Entries[c].Id,name:b.Entries[c].Name,series:[]};j[d]={id:b.Entries[c].Id,name:b.Entries[c].Name,series:[]};l[d]={id:b.Entries[c].Id,name:b.Entries[c].Name,series:[]}}h=b.Entries[c].Month.toString();if(b.Entries[c].Month<10)h="0"+h;f=b.Entries[c].Year.toString()+"-"+h+"-01";i[d].series[e]=[f,b.Entries[c].AverageFuelEfficiency];j[d].series[e]=[f,b.Entries[c].TotalDistance];l[d].series[e]=[f,b.Entries[c].TotalCost];k[d][e]=f;e+=1;n=b.Entries[c].Id}g._setupDateRange(k);g.selectableVehicles=m;g.selectableVehiclesDirty=a;g._setOption("chartData",[i,j,l])},_setupDateRange:function(c){var a=this;for(var i,g,h,e,f,d=[],b=0;b<c.length;b+=1){g=a._convertToUTCDate(c[b][0]);if(e===undefined||g<e)e=g;i=c[b].length-1;h=a._convertToUTCDate(c[b][i]);if(f===undefined||h>f)f=h}d=a._buildMonthListWithoutGaps(e,f);a.dateRange.max=d.length;a.dateRange.upper=d.length-1;a.datesInDateRange=d},_buildMonthListWithoutGaps:function(c,d){var a,e,b,g,f=[];if(c===undefined||d===undefined)return[];e={year:c.getUTCFullYear(),month:c.getUTCMonth()};b={year:d.getUTCFullYear(),month:d.getUTCMonth()};a=e;while(a.year<b.year||a.year===b.year&&a.month<=b.month){g=a.month<10?"0":"";f.push(a.year+"-"+g+a.month+"-01");if(a.month===12){a.year+=1;a.month=0}a.month+=1}return f},_refreshChart:function(){var a=this;a._updateSelectableVehicleList();if(a.currentChart>=0&&a.currentChart<a.wellKnownChartTitles.length&&a.dateRange.max>0){a.element.find(f).show();if(a.options.chartData&&a.options.chartData.length>a.currentChart)a._plotChart(f,a.wellKnownChartTitles[a.currentChart],a.options.chartData[a.currentChart]);else a._showNoChartDataAvailableError()}else a._showNoChartDataAvailableError()},_plotChart:function(g,h,f){var e=this;if(!f||!f.length){e._showNoChartDataAvailableError();return}var d=e._getJQPlotSeries(f);e.element.find(g).children().remove();if(!d||!d.values.length)return;b.jqplot(g.slice(1),d.values,{title:h,noDataIndicator:{show:a,indicator:"No Data to Display"},axes:{xaxis:{renderer:b.jqplot.DateAxisRenderer,tickInterval:"2 months",rendererOptions:{tickRenderer:b.jqplot.CanvasAxisTickRenderer},tickOptions:{angle:0,fontStretch:1,fontSize:"10pt",fontWeight:"normal",fontFamily:"Tahoma",formatString:"%m-%y"}}},axesDefaults:{useSeriesColor:a},cursor:{showVerticalLine:a,showHorizontalLine:a,showCursorLegend:a,showTooltip:c,zoom:a,intersectionThreshold:6},legend:{location:"s",show:a},seriesDefaults:{showMarker:a},series:d.labels.concat([{lineWidth:4,markerOptions:{style:"filledCircle"}}]),seriesColors:d.colors});e._hideNoChartDataAvailableError()},_updateSelectableVehicleList:function(){var e="<div/>",a=this,g=a,f,d;if(!a.selectableVehiclesDirty)return;if(a.selectableVehicles){f=b(e);f.children().remove();for(d=0;d<a.selectableVehicles.length;d+=1)b(e).addClass("chart-selectable-vehicle").append(b(e).css("background-color",a.wellKnownSeriesColors[d].toString()).addClass("chart-selectable-vehicle-color")).append(b('<input type="checkbox"></input>').addClass("chart-selectable-vehicle-checkbox").attr("name",a.selectableVehicles[d].id.toString()).text(a.selectableVehicles[d].name).val(a.selectableVehicles[d].id.toString())).appendTo(f);g.element.find("#vehicle-selection-list").children().remove().end().append(f.html()).find("input").attr("checked","checked").bind("click",function(){g._refreshChart()})}a.selectableVehiclesDirty=c},_showNoChartDataAvailableError:function(){var a=this;a.element.find(f).hide().children().remove();a.element.find(l).hide();a.element.find(m).show();a.element.find(e).hide()},_hideNoChartDataAvailableError:function(){this.element.find(e).hide();this.element.find(m).hide();this.element.find(l).show()},_getJQPlotSeries:function(b){for(var e=[],d=[],f=[],c=0,g=this.element.find("#vehicle-selection"),a=0;a<b.length;a+=1)if(b[a].series.length!==0&&g.find('input:checked[name="'+b[a].id+'"]').length>0){e[c]={label:b[a].name};d[c]=this.wellKnownSeriesColors[a];f[c]=this._filterSeriesByDateRange(b[a].series);c+=1}return{labels:e,colors:d,values:f}},_filterSeriesByDateRange:function(c){var a=this,d=a.datesInDateRange[a.dateRange.lower],f=a.datesInDateRange[a.dateRange.upper],e=a;return b.grep(c,function(a){return e._isDateInRange(a[0],d,f)})},_isDateInRange:function(d,g,h){var b=this._convertToUTCDate(d),e=this._convertToUTCDate(g),f=this._convertToUTCDate(h);return b<e||b>f?c:a},_convertToUTCDate:function(d){var e=/(\d{4})-(\d{2})-(\d{2})/g,a,c,b;a=e.exec(d);c=a[1];b=a[2];return new Date(c,b,1)},moveOnScreenFromRight:function(){var b=this;if(!b.options.isOnScreen){b.element.removeClass("empty").css({left:500,opacity:0,position:n}).show().delay(q).animate({left:"-=500",opacity:1},{duration:o,complete:function(){b.element.css({position:g})}});b.options.isOnScreen=a}},moveOffScreenToRight:function(){var a=this;if(a.options.isOnScreen){a.element.css({position:n,top:0}).animate({left:"+=500",opacity:0},{duration:o,complete:function(){a.element.css({position:g});a.element.hide()}});a.options.isOnScreen=c}},destroy:function(){var a=this,c="."+a.name;a.element.find(d).slider("destroy");a.element.find(h).unbind(c);a.element.find(i).unbind(c);a.element.find(j).unbind(c);b.Widget.prototype.destroy.call(a)}})})(this.mstats=this.mstats||{},jQuery);(function(a,c){var b="#pinnedSiteCallout",d;a.pinnedSite={intializePinndedSiteImage:function(){try{if(!(document.documentMode===undefined||a.pinnedSite.isPinned())){c("#pinnedSiteImage").bind("mousedown mouseout",a.pinnedSite.hideCallout).bind("mouseover",a.pinnedSite.showCallout).addClass("active");c(b).show();setTimeout(a.pinnedSite.hideCallout,5e3)}}catch(d){}},intializeData:function(b){d=b;a.pinnedSite.requeryJumpList()},showCallout:function(){c(b).show()},hideCallout:function(){c(b).hide()},requeryJumpList:function(){try{a.pinnedSite.isPinned()&&d({url:"/reminder/overduelist/",type:"POST",contentType:"application/json",dataType:"json",cache:false,success:function(b){try{var c=window.external,e,f,d,g;c.msSiteModeClearJumpList();c.msSiteModeCreateJumpList("Reminders");c.msSiteModeClearIconOverlay();if(b.Reminders){for(d=0;d<b.Reminders.length;d+=1){g=a.getRelativeEndpointUrl("/reminder/details/"+b.Reminders[d].Reminder.ReminderId.toString());c.msSiteModeAddJumpListItem(b.Reminders[d].FullTitle,g,"./favicon.ico","self")}if(b.Reminders.length>0){e="/content/overlay-"+b.Reminders.length+".ico";f="You have "+b.Reminders.length.toString()+" maintenance tasks that are ready to be accomplished.";if(b.Reminders.length>3)e="/content/overlay-3plus.ico";c.msSiteModeSetIconOverlay(e,f)}}c.msSiteModeShowJumpList()}catch(h){}}})}catch(b){}},isPinned:function(){try{return window.external.msIsSiteMode()}catch(a){return false}}}})(this.mstats=this.mstats||{},jQuery);(function(b,c){var a=".mstats-statistics-content",f="mstats-statistics-content",e="#statistics-content",d="mstats-statistics";c.widget("mstats.statisticsPane",{options:{sendRequest:function(a){c.ajax(a)},invalidateData:function(){b.log("The invalidateData option on statisticsPane has not been set")},publish:function(){b.log("The publish option on summaryPane has not been set")}},_create:function(){b.statisticsPane=this;this._addClasses();this._getStatisticsData()},_addClasses:function(){this.element.addClass(d).find(e).addClass(f)},_applyTemplate:function(f){var e=this.options,d=c(e.templateId);if(!d.length){b.log("Cannot apply templates as there is no template defined.");return}this.element.find(a).html(d.tmpl(f));this._addClasses()},_getStatisticsData:function(){var a=this;a.options.sendRequest({url:a.options.dataUrl,success:function(b){a._applyTemplate(b);a._showStatistics();a.option(a.options)},error:function(){a._hideStatistics();a._showErrorMessage()}})},_showStatistics:function(){this.element.find(a).show()},_hideStatistics:function(){this.element.find(a).hide()},_publishStatus:function(a){c.isFunction(this.options.publish)&&this.options.publish(b.events.status,a)},_showErrorMessage:function(){this._publishStatus({type:"loadingError",message:"An error occurred while loading your overall statistics.  Please try again.",duration:1e4})},refreshData:function(){this._getStatisticsData()},requeryData:function(){this.options.invalidateData(this.options.dataUrl);this.refreshData()},destroy:function(){c.Widget.prototype.destroy.call(this);this.element.removeClass(d).find(e).removeClass(f).end().find("#statistics-status").removeClass("mstats-statistics-status")}})})(this.mstats=this.mstats||{},jQuery);(function(c,a){var b=".mstats-reminders-content",f="mstats-reminders-content",e="#summary-reminders-content",d="mstats-reminders";a.widget("mstats.imminentRemindersPane",{options:{sendRequest:function(b){a.ajax(b)},invalidateData:function(){c.log("The invalidateData option on imminentReminders has not been set")},publish:function(){c.log("The publish option on imminentReminders has not been set")}},_create:function(){c.imminentRemindersPane=this;this._addClasses();this._getImminentReminderData()},_addClasses:function(){this.element.addClass(d).find(e).addClass(f)},_applyTemplate:function(e){if(!a(this.options.templateId).length){c.log("Cannot apply templates as there is no template defined.");return}var d={ReminderList:e};this.element.find(b).html(a(this.options.templateId).tmpl(d,{createRemindersLink:function(e){var b=a.bbq.getState()||{},d=c.getRelativeEndpointUrl("/Dashboard");b.layout="reminders";b.vid=e;return a.param.fragment(d,b)}}))},_getImminentReminderData:function(){var a=this;a._hideReminders();a.options.sendRequest({url:a.options.dataUrl,success:function(b){a._applyTemplate(b);a._showReminders();a.option(a.options)},error:function(){a._hideReminders();a._showErrorMessage()}})},_showReminders:function(){this.element.find(b).show()},_hideReminders:function(){this.element.find(b).hide()},refreshData:function(){this._getImminentReminderData()},requeryData:function(){this.options.invalidateData(this.options.dataUrl);this.refreshData()},_publishStatus:function(b){a.isFunction(this.options.publish)&&this.options.publish(c.events.status,b)},_showErrorMessage:function(){this._publishStatus({type:"loadError",message:"An error occurred while loading the summary reminders data.  Please try again.",duration:1e4})},destroy:function(){a.Widget.prototype.destroy.call(this);this.element.removeClass(d).find(e).removeClass(f)}})})(this.mstats=this.mstats||{},jQuery);(function(b,a){var j="requeryData",i="isOnScreen",h="#reminders",g="#statistics",f="#registration",e="mstats-summary-content",d="#summary-content",c="mstats-summary",k=600,l=400;a.widget("mstats.summaryPane",{options:{isOnScreen:true,sendRequest:function(b){a.ajax(b)},publish:function(){b.log("The publish option on summaryPane has not been set")},invalidateData:function(){b.log("The invalidateData option on summaryPane has not been set")}},_create:function(){var a=this;b.summaryPane=a;a._addClasses();a._setupRegistrationWidget();a._setupStatisticsWidget();a._setupRemindersWidget()},_addClasses:function(){this.element.addClass(c).find(d).addClass(e)},_setupRegistrationWidget:function(){b.summaryPane.registration=a(f).registration({dataUrl:"/Profile/JsonCompleteRegistration",publish:this.options.publish,sendRequest:this.options.sendRequest})},_setupStatisticsWidget:function(){b.summaryPane.statistics=a(g).statisticsPane({sendRequest:this.options.sendRequest,dataUrl:"/Vehicle/JsonFleetStatistics",invalidateData:this.options.invalidateData,templateId:"#fleet-statistics-template"})},_setupRemindersWidget:function(){b.summaryPane.reminders=a(h).imminentRemindersPane({sendRequest:this.options.sendRequest,dataUrl:"/Reminder/JsonImminentReminders",invalidateData:this.options.invalidateData,templateId:"#summary-imminent-reminders-template"})},moveOffScreen:function(){var a=this;a.element.css("position","absolute").delay(l).animate({left:"-=350",opacity:0},{duration:k,complete:function(){a.element.hide()}});a._setOption(i,false)},moveOnScreen:function(){this.element.css("opacity",0).animate({opacity:1,left:"+=350"},k).show();this._setOption(i,true)},requeryStatistics:function(){b.summaryPane.statistics.statisticsPane(j)},requeryReminders:function(){b.summaryPane.reminders.imminentRemindersPane(j)},destroy:function(){var b="destroy";a.Widget.prototype.destroy.call(this);a(g).statisticsPane(b);a(f).registrationPane(b);a(h).imminentRemindersPane(b);this.element.removeClass(c).find(d).removeClass(e)}})})(this.mstats=this.mstats||{},jQuery);(function(a,c){var d="title",b="dashboard";c.widget("mstats.layoutManager",{options:{layout:b,subscribe:function(){a.log("The subscribe option on layoutManager has not been set")}},_create:function(){var a=this,b=c.bbq.getState()||{};a._subscribeToGlobalEvents();a._subscribeToHashChange();b&&b.layout&&a._setOption("layout",b.layout);a._changeLayout(b)},_subscribeToGlobalEvents:function(){var d=this,e={};if(c.isFunction(d.options.subscribe)){d.options.subscribe(a.events.vehicle.deleted,function(){a.summaryPane.requeryStatistics();a.summaryPane.requeryReminders();a.vehicleList.requeryData();a.charts.requeryData();e.layout=b;c.bbq.pushState(e,2)},d);d.options.subscribe(a.events.vehicle.reminders.fulfilled,function(){a.summaryPane.requeryStatistics();a.summaryPane.requeryReminders();a.infoPane.requeryVehicleDetails();a.infoPane.requeryReminders();a.charts.requeryData();a.pinnedSite.requeryJumpList()},d)}},_changeLayout:function(e){var c=this;c._setOption("layout",e.layout||b);c._setupInfoPaneOptions(e);switch(c.options.layout){case b:a.header.option(d,"Dashboard");c._goToDashboardLayout();break;case"charts":c._goToChartsLayout();a.header.option(d,"Charts");break;case"details":c._setHeaderForSelectedVehicle("Details");c._goToDetailsLayout();break;case"fillups":c._setHeaderForSelectedVehicle("Fill ups");c._goToDetailsLayout();break;case"reminders":c._setHeaderForSelectedVehicle("Reminders");c._goToDetailsLayout()}},_setHeaderForSelectedVehicle:function(e){var c=a.vehicleDetails.getSelectedVehicleName(),b=e;if(c)b=b+" for "+c;a.header.option(d,b)},_subscribeToHashChange:function(){var a=this;c(window).bind("hashchange.layoutManager",function(d){var b=c.deparam.querystring(d.fragment);if(b.vid)b.vid=parseInt(b.vid,10);a._changeLayout(b)})},_goToChartsLayout:function(){a.summaryPane.options.isOnScreen&&a.summaryPane.moveOffScreen();a.vehicleList.options.isOnScreen&&a.vehicleList.moveOffScreen();a.infoPane.options.isOnScreen&&a.infoPane.moveOffScreenToRight();if(!a.charts.options.isOnScreen){a.charts.moveOnScreenFromRight();a.charts.showMainFuelEfficiencyChart()}},_setupInfoPaneOptions:function(c){var b="selectedVehicleId";a.vehicleList.option(b,c.vid);a.infoPane.option(b,c.vid);a.infoPane.option("activePane",c.layout)},_goToDetailsLayout:function(){a.charts.options.isOnScreen&&a.charts.moveOffScreenToRight();a.summaryPane.options.isOnScreen&&a.summaryPane.moveOffScreen();!a.vehicleList.options.isOnScreen&&a.vehicleList.moveOnScreen();!a.infoPane.options.isOnScreen&&a.infoPane.moveOnScreenFromRight();a.vehicleList.goToDetailsLayout()},_goToDashboardLayout:function(){a.charts.options.isOnScreen&&a.charts.moveOffScreenToRight();!a.summaryPane.options.isOnScreen&&a.summaryPane.moveOnScreen();!a.vehicleList.options.isOnScreen&&a.vehicleList.moveOnScreen();a.infoPane.options.isOnScreen&&a.infoPane.moveOffScreenToRight();a.vehicleList.goToDashboardLayout()},destroy:function(){c.Widget.prototype.destroy.call(this)}})})(this.mstats=this.mstats||{},jQuery);(function(c,a){c.VehicleDropDownMonitor=function b(f,e){if(!(this instanceof b))return new b(f,e);var d={};d.initialize=function(){var c="Could not load vehicle data lists.",b=":first",f=a("#vehicleEditForm"),i=a("#Year",f),g=a("#MakeName",f),h=a("#ModelName",f);f.find('input[name="UpdateMakes"]').remove().end().find('input[name="UpdateModels"]').remove();i.change(function(){g.children().not(b).remove();h.children().not(b).remove();e({type:"POST",dataType:"json",url:"/Vehicle/MakesForYear",data:{year:i.val()},cache:false,success:function(a){d._updateList(a,g)},error:function(){d._publishError(c)}})});g.change(function(){h.children().not(b).remove();e({type:"POST",dataType:"json",url:"/Vehicle/ModelsForMake",cache:false,data:{year:i.val(),make:g.val()},success:function(a){d._updateList(a,h)},error:function(){d._publishError(c)}})})};d._updateList=function(c,b){a.each(c,function(d,c){b.append(a("<option></option>").attr("value",c).text(c))})};d._publishError=function(a){f(c.events.status,{type:"loadError",message:a})};return d}})(this.mstats=this.mstats||{},jQuery);$(function(){$(document).ajaxError(function(d,a){a.status===200&&a.responseText.indexOf("Mileage Stats Sign In")!==-1&&window.location.replace(mstats.getRelativeEndpointUrl("/Auth/SignIn"))});$("#notification").status({subscribe:mstats.pubsub.subscribe});$("#header").header();if(!window.location.pathname.match(/Dashboard/))return;$("#vehicles").vehicleList({publish:mstats.pubsub.publish,sendRequest:mstats.dataManager.sendRequest,invalidateData:mstats.dataManager.resetData,templateId:"#mstats-vehicle-list-template"});$("#info").infoPane({sendRequest:mstats.dataManager.sendRequest,invalidateData:mstats.dataManager.resetData,publish:mstats.pubsub.publish});$("#summary").summaryPane({sendRequest:mstats.dataManager.sendRequest,invalidateData:mstats.dataManager.resetData,publish:mstats.pubsub.publish});$("#main-chart").charts({sendRequest:mstats.dataManager.sendRequest,invalidateData:mstats.dataManager.resetData});$("#header").layoutManager({subscribe:mstats.pubsub.subscribe});mstats.pinnedSite.intializeData(mstats.dataManager.sendRequest)});